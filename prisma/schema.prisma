generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Workspace {
  id String @id @default(uuid())

  name           String
  description    String   @default("")
  repository     String
  setupScript    String   @default("") @map("setup_script")
  postScript     String   @default("") @map("post_script")
  cacheFiles     String[] @default([]) @map("cache_files")
  env            String[] @default([])
  secrets        String[] @default([])
  containerImage String   @map("container_image")

  tasks Task[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Task {
  id String @id @default(uuid())

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id])

  workspaceId String    @map("workspace_id")
  workspace   Workspace @relation(fields: [workspaceId], references: [id])

  messages Message[]

  name      String
  branch    String
  container String  @map("container")
  archived  Boolean @default(false)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Message {
  id String @id @default(uuid())

  taskId String @map("task_id")
  task   Task   @relation(fields: [taskId], references: [id])

  role    String
  content String

  createdAt DateTime @default(now()) @map("created_at")
}

model User {
  id String @id @default(uuid())

  settings UserSettings?
  threads  Task[]

  username String @unique
  name     String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model UserSettings {
  id String @id @default(uuid())

  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id])

  voiceEnabled Boolean @default(true)
  voiceHotkey  String  @default("Control+Num0")

  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user_settings")
}
